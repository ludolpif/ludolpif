## Pense bête

- Alt+F2 featherpad à la place de gedit
- LXQt utilise Xorg par défaut

## Installation debian depuis ISO

- Install from iso debian-testing weekly 2025-06-08 (debian 13)
- user : ludolpif, mdp root et user settés (ludolpif n'est pas pas sudoer, mais sudo est installé)
- Tout par défaut, dans tasksel choisir LxQT, LXQT, utilitaires usuels du système
- premier boot, le login manager affiche un gros clavier visuel, layout US mais passe en FR pour tapper le password
- popup gestion de l'énergie, faire la config (Paramètres de grestion de l'alimentation)
  - Batterie : niveau faible : 10%, quand la batterie est faible: ne rien faire
  - Capot : Sur batterie : suspendre, branché : éteindre moniteur
  - Inactivité : décocher "configurer le comportement en cas d'inactivité"

```
root@lud-5490:~# apt install lxqt-panel lxqt-core mpv # pour marquer en manuel
root@lud-5490:~# apt autoremove --purge avahi-daemon bluez cups-server-common gcr gnome-accessibility-themes
root@lud-5490:~# apt autoremove --purge hexchat libreoffice-common meteo-qt orca plymouth sudo synaptic
root@lud-5490:~# apt autoremove --purge thunderbird xorg-docs-core xsane xscreensaver
# plymouth == splash screen de boot qui masque des détails utiles les jours de panne
root@lud-5490:~# ln -s /bin/true /usr/local/bin/xdg-screensaver
root@lud-5490:~# rm -r /etc/cups
```

## Outils que j'aime avoir sous la main
```
root@lud-5490:~# apt install build-essential btop chromium curl duf fdfind fonts-noto-core git gmidimonitor gimp nvtop
root@lud-5490:~# apt install hunspell-fr-revised inotify-tools jq keepassxc mate-calc oathtool rsync ssh
root@lud-5490:~# apt install strace tcpdump uvcdynctrl vim xarchiver
root@lud-5490:~# apt install kdenlive dvdauthor-

root@lud-5490:~# sed -i -e 's/^#\?\s*PasswordAuthentication\s\+.*$/PasswordAuthentication no/' /etc/ssh/sshd_config
root@lud-5490:~# service ssh restart
```

## Personnalisation d'outils ligne de commande pour moi et pour le stream

```
root@lud-5490:~# echo 'HISTFILESIZE=0' > /etc/profile.d/no_history.sh

root@lud-5490:~# tee /etc/skel/.vimrc > /root/.vimrc <<EOT
runtime! defaults.vim
runtime! debian.vim
if &diff
  syntax off
else
  set mouse=
end
set background=dark
EOT
ludolpif@lud-5490:~$ cp /etc/skel/.vimrc ~

root@lud-5490:~# update-alternatives --config editor
# J'aime choisir /usr/bin/vim.basic

root@lud-5490:~# editor ~/.bashrc
# Décommenter pour avoir de la couleur et des alias
# Importer les sections pour xterm title, .bash_aliases et bash_completion depuis /etc/skel/.bashrc

root@lud-5490:~# editor ~/.bash_aliases
# Ajouter des fonctions *_stream() et des alias pour masquer
#  certaines valeurs dans les résultats de commandes interactives
root@lud-5490:~# cp ~/.bash_aliases /etc/skel
root@lud-5490:~# install -o ludolpif -g ludolpif -m 0644 /etc/skel/.bash_aliases ~ludolpif/
```

## Fix SDDM login screen
```
root@lud-5490:~# apt remove --purge qt6-virtualkeyboard-plugin
```

## Fix systemd
Si un service déconne, le penalty est de 90 secondes par défaut, mettre 9s.

```
root@lud-5490:~# vim /etc/systemd/system.conf
DefaultTimeoutStartSec=9s
DefaultTimeoutStopSec=9s
#DefaultTimeoutAbortSec=
DefaultDeviceTimeoutSec=9s
```

## Fix wifi/wired route priorities

- Si la connexion filaire est gérée par ifupdown (mentionné dans /etc/network/interfaces)
 -> sa métrique de route sera de 1002.
- Si le Wi-Fi est géré par Network-Manager
 -> sa métrique de route sera de 600.

Cette métrique est un coût (+ faible = préférable), le Wi-Fi sera donc utilisé en priorité.
Pour obtenir une métrique de 100 sur une connexion filaire,
 il suffit de ne pas la mentionner du tout dans /etc/network/interfaces.

Configuration personnalisée pour les routes du homelab depuis lud-5490 dans `/etc/NetworkManager/system-connections/LAN.nmconnection` :
```
[connection]
id=LAN
uuid=6968082e-abcd-34b2-be88-2c2119bb7070
type=ethernet
autoconnect-priority=-999
interface-name=enp0s31f6
timestamp=1755098765

[ethernet]

[ipv4]
method=auto
route1=192.0.2.0/24,192.168.1.42
route2=192.168.0.0/16,192.168.1.42
route3=198.51.100.0/24,192.168.1.42

[ipv6]
addr-gen-mode=default
method=auto
route1=2001:db8::/32,fe80::20e:c6ff:fe6a:b41e

[proxy]
```

Ajouter également les routes du homelan sur la connexion Wifi.

## Enable SysRq to have manual OOM killer

```
root@lud-5490:~# echo "kernel.sysrq = 1" | tee /etc/sysctl.d/sysrq.conf
root@lud-5490:~# /usr/lib/systemd/systemd-sysctl
root@lud-5490:~# cat /proc/sys/kernel/sysrq
1
```

sysrq: HELP : loglevel(0-9) reboot(b) crash(c) terminate-all-tasks(e) memory-full-oom-kill(f) kill-all-tasks(i)
 thaw-filesystems(j) sak(k) show-backtrace-all-active-cpus(l) show-memory-usage(m) nice-all-RT-tasks(n)
 poweroff(o) show-registers(p) show-all-timers(q) unraw(r) sync(s) show-task-states(t) unmount(u) force-fb(v)
 show-blocked-tasks(w) dump-ftrace-buffer(z) replay-kernel-logs(R)

## Fix brightness keys and 0% luminosity

Note : `pkexec` est nécessaire pour `/usr/bin/lxqt-config-brightness`
 et le paquet liblxqt-backlight-helper semble nécessaire également.

```
ludolpif@lud-5490:~$ mkdir bin
ludolpif@lud-5490:~$ cat bin/backlight.sh <<EOT
#!/bin/bash
read driver max curr < <(pkexec lxqt-backlight_backend --show)
#echo "driver: $driver, max: $max, curr: $curr"

step_min=$((max/200))
step=$((curr/10))
if [ $step -lt $step_min ]; then step=$step_min; fi
if [ $step -eq 0 ]; then step=1; fi

case $1 in
	--inc) next=$((curr+$step)); if [ $next -gt $max  ]; then next=$max  ; fi ;;
	--dec) next=$((curr-$step)); if [ $next -lt $step ]; then next=$step ; fi ;;
	*) echo "Usage: $0 (--inc|--dec)" >&2; exit 1 ;;
esac
pkexec lxqt-backlight_backend $next
EOT

ludolpif@lud-5490:~$ chmod +x bin/backlight.sh
```

- Dans les raccourcis globaux, associer les touches Backlight à la commande `/home/ludolpif/bin/backlight.sh` avec `--inc` et `--dec` respectivement

## Config d'écrans particulières

lxqt-config-monitor ne propose l'option mirroir or j'ai fixé un écran au plafond et j'utilise un mirroir. (Ouais t'inquiètes).

```
root@lud-5490:~# apt install autorandr
ludolpif@lud-5490:~$ lxqt-config-monitor
root@lud-5490:~# dpkg-divert --divert /usr/share/dbus-1/services/org.kde.kscreen.disabled \
                             --rename /usr/share/dbus-1/services/org.kde.kscreen.service

ludolpif@lud-5490:~$ xrandr --listmonitors
Monitors: 2
 0: +*eDP-1 1366/309x768/173+1280+0  eDP-1
 1: +HDMI-1 1280/376x1024/301+0+0  HDMI-1
ludolpif@lud-5490:~$ xrandr --output "HDMI-1" --fb $((1366+1280))x768 --transform 1,0,0,0,1,-256,0,0,1 --filter nearest --reflect y
ludolpif@lud-5490:~$ autorandr --save stream
Saved current configuration as profile 'stream'
ludolpif@lud-5490:~$ ls /etc/xdg/autostart/autorandr*
/etc/xdg/autostart/autorandr.desktop  /etc/xdg/autostart/autorandr-kde.desktop

root@lud-5490:~# cat > /etc/sddm/Xsetup
#!/bin/sh
# Xsetup - run as root before the login dialog appears
xrandr --output HDMI-1 --off
^D
root@lud-5490:~# chmod +x /etc/sddm/Xsetup

root@lud-5490:~# cat > /etc/sddm.conf
[XDisplay]
# Xsetup script path
# A script to execute when starting the display server
DisplayCommand=/etc/sddm/Xsetup
^D

root@lud-5490:~# reboot
```

## Editeur de texte (featherpad)

Options / Préférences / Texte / Chemin vers le dictionnaire hunspell : `/usr/share/hunspell/fr_FR.dic`

## Terminal

`qterminal` est installé par défaut. Fichier / Préférences... / Apparence / Transparence du terminal : 0%

## Screencapture

- Dans les raccourcis globaux, associer PrintScreen avec rien, shift, alt à screengrab avec les options -r -f -a respectivement.


## Désactiver quelques périphériques

Car les fallbacks et default dans obs, easyeffects, etc ça déconne un peu.

```
root@lud-5490:~# cat > /etc/udev/rules.d/90-blacklist-unused-audio-video-capture-dev.rules <<"EOT"
# lsusb
# udevadm info -a -p /sys/class/video4linux/video3
# udevadm control --reload-rules # for devices than can be unplugged then replugged

# Disables Logitech, Inc. Webcam C930e audio
SUBSYSTEM=="usb", DRIVER=="snd-usb-audio", ATTRS{idVendor}=="046d", ATTRS{idProduct}=="0843", ATTR{authorized}="0"
# Disable 0c45:6717 Microdia Integrated_Webcam_HD audio and video
SUBSYSTEM=="usb", ATTRS{idVendor}=="0c45", ATTRS{idProduct}=="6717", ATTR{authorized}="0"
EOT
```

- Menu LxQT / icône rouage : Centre de configuration LxQT
  - Clavier / Disposition du clavier : French (alt.)
  - Paramétreur de session LXQt / Lancement automatique de LxQt : désactiver Qlipper et XScreenSaver
  - Touches de raccourcis
    - Raccourci : Ctrl+Alt+T
    - Description : Terminal
    - Commande : x-terminal-emulator
  - Clic-droit sur l'heure en bas / Configurer "Horloge virtuelle"
    - Cocher Date, format ISO 8601, position Avant


## Linux VA driver (avec encodeur HW intel)

Pas ajouté non-free pour uniquement ce paquet.

```
root@lud-5490:/opt# wget http://ftp.fr.debian.org/debian/pool/non-free/i/intel-media-driver-non-free/intel-media-va-driver-non-free_25.2.3+ds1-1_amd64.deb
root@lud-5490:/opt# apt remove --purge intel-media-va-driver
root@lud-5490:/opt# dpkg -i intel-media-va-driver-non-free_25.2.3+ds1-1_amd64.deb
```

## OBS from sources
```
root@lud-5490:~# apt build-dep obs-studio

ludolpif@lud-5490:~$ cd obs/
ludolpif@lud-5490:~/obs$ ls
ludolpif@lud-5490:~/obs$ mkdir pkg
ludolpif@lud-5490:~/obs$ cd pkg/
ludolpif@lud-5490:~/obs/pkg$ apt source obs-studio
ludolpif@lud-5490:~/obs/pkg$ wget https://cdn-fastly.obsproject.com/downloads/cef_binary_5060_linux64.tar.bz2
ludolpif@lud-5490:~/obs/pkg$ tar xf cef_binary_5060_linux64.tar.bz2

ludolpif@lud-5490:~/obs/pkg$ cd obs-studio-*
ludolpif@lud-5490:~/obs/pkg/obs-studio-30.2.3+dfsg$ dpkg-buildpackage -us -uc
# Par défaut, no browser mode, car ne va pas prendre le cef binary car non dispo/facile from sources
# tuto debian 12 : https://obsproject.com/forum/threads/debian-obs-studio-build-mini-howto.169680/
# cef builds https://cef-builds.spotifycdn.com/index.html#linux64
# mais la 30.2.3 dépends toujorus de cef_binary_5060

root@lud-5490:~# dpkg -i ~ludolpif/obs/pkg/{libobs0t64,obs-studio,obs-plugins}_30.2.3+dfsg-3_amd64.deb

# Pour build des plugins
root@lud-5490:~# dpkg -i ~ludolpif/obs/pkg/libobs-dev_30.2.3+dfsg-3_amd64.deb

ludolpif@lud-5490:~/obs/pkg/try-build-plugins$ apt source obs-move-transition
ludolpif@lud-5490:~/obs/pkg/try-build-plugins$ git clone https://github.com/sorayuki/obs-multi-rtmp.git
ludolpif@lud-5490:~/obs/pkg/try-build-plugins$ cd obs-multi-rtmp
ludolpif@lud-5490:~/obs/pkg/try-build-plugins/obs-multi-rtmp$ git checkout a629a19cc62589e9c12f883946c45dca2cc76070 && cd ..
ludolpif@lud-5490:~/obs/pkg/try-build-plugins$ mv obs-multi-rtmp obs-multi-rtmp-0.6.0.1
ludolpif@lud-5490:~/obs/pkg/try-build-plugins$ tar cvzf obs-multi-rtmp_0.6.0.1.orig.tar.gz --exclude .git obs-multi-rtmp-0.6.0.1/
ludolpif@lud-5490:~/obs/pkg/try-build-plugins$ cd obs-multi-rtmp-0.6.0.1/
ludolpif@lud-5490:~/obs/pkg/try-build-plugins/obs-multi-rtmp-0.6.0.1$ tar xf ../obs-move-transition_3.1.2-1.debian.tar.xz && cd debian
ludolpif@lud-5490:~/obs/pkg/try-build-plugins/obs-multi-rtmp-0.6.0.1/debian$ editor *
ludolpif@lud-5490:~/obs/pkg/try-build-plugins/obs-multi-rtmp-0.6.0.1/debian$ cd ..
ludolpif@lud-5490:~/obs/pkg/try-build-plugins/obs-multi-rtmp-0.6.0.1$ dpkg-buildpackage -us -uc


# Essais de plugins déjà packagés dans debian

ludolpif@lud-5490:~$ apt-cache search ^obs-
root@lud-5490:~# apt install obs-color-monitor obs-move-transition obs-pipewire-audio-capture obs-retro-effects obs-stroke-glow-shadow obs-time-source
```

## Draw.io, Schémas (en local)

```
root@lud-5490:/opt# wget https://github.com/jgraph/drawio-desktop/releases/download/v28.0.6/drawio-amd64-28.0.6.deb
root@lud-5490:/opt# dpkg -i drawio-amd64-28.0.6.deb
```

Le dark-mode est dans le menu "Suppléments"... parce que pourquoi pas.

## Discord

https://github.com/palfrey/discord-apt?tab=readme-ov-file

```
root@lud-5490:~# dpkg -i ~ludolpif/Téléchargements/discord-repo_1.0_all.deb
root@lud-5490:~# apt install -f
root@lud-5490:~# apt update
root@lud-5490:~# apt install discord

ludolpif@lud-5490:~$ discord
ludolpif@lud-5490:~$ touch ~ludolpif/.config/discord/Cache/NOBACKUPDIR.TAG
```

## Soundboard

Soundux semble un dead project :(

TODO, documenter : obs-soundboard compilé à la main en .deb ... s'il est en réalité intéressant à utiliser.

## ASCII animations

```
root@lud-5490:~# apt install sl
ludolpif@lud-5490:~$ sl # Le train de la hype !
```

## git

```
# Import depuis une précédente install (ou regénérer toutes les clés)
ludolpif@lud-5490:/mnt/tmp/home/ludolpif/.ssh$ mv authorized_keys id_rsa* ~/.ssh/

ludolpif@lud-5490:~$ git config --global user.email ludolpif@gmail.com
ludolpif@lud-5490:~$ git config --global user.name ludolpif
ludolpif@lud-5490:~$ mkdir git
ludolpif@lud-5490:~$ cd git
ludolpif@lud-5490:~/git$ git clone https://github.com/ludolpif/ludolpif
ludolpif@lud-5490:~/git$ cd ludolpif
```

## Rust + Bevy

https://www.rust-lang.org/learn/get-started

```
ludolpif@lud-5490:~/git$ mkdir bevy
ludolpif@lud-5490:~/git$ cd bevy/
ludolpif@lud-5490:~/git/bevy$ git clone -b v0.16.1 https://github.com/bevyengine/bevy
ludolpif@lud-5490:~/git/bevy$ git clone https://github.com/ludolpif/hello-bevy
ludolpif@lud-5490:~/git/bevy$ cd hello-bevy

root@lud-5490:/home/ludolpif/git/bevy/hello-bevy# ./build-deps-systemwide.sh

ludolpif@lud-5490:~/git/bevy$ editor Cargo.toml
ludolpif@lud-5490:~/git/bevy/hello-bevy$ ./build-deps-userwide.sh
ludolpif@lud-5490:~/git/bevy/hello-bevy$ cargo update
ludolpif@lud-5490:~/git/bevy/hello-bevy$ cargo build
```

## Swapfile et zswap pour rust-analyser + laptop trop juste en RAM

```
root@lud-5490:/# dd if=/dev/zero of=/home/swap.img bs=1M count=8k
8192+0 enregistrements lus
8192+0 enregistrements écrits
8589934592 octets (8,6 GB, 8,0 GiB) copiés, 36,4064 s, 236 MB/s
root@lud-5490:/# mkswap /home/swap.img
mkswap: /home/swap.img : droits 0664 non sûrs, corriger avec : chmod 0600 /home/swap.img
Configure l'espace d'échange (swap) en version 1, taille = 8 GiB (8589930496 octets)
pas d'étiquette, UUID=add9da34-2c8c-47e6-bfb2-a24c81b69cdf
root@lud-5490:~# chmod 0600 /home/swap.img
root@lud-5490:/# echo "/home/swap.img       none            swap    defaults        0       0" | tee -a /etc/fstab
root@lud-5490:/# systemctl daemon-reload
root@lud-5490:/# swapon -a
root@lud-5490:/# swapon -s
Nom fichier                             Type            Taille          Utilisé         Priorité
/home/swap.img                          file            1048572         0               -2
root@lud-5490:/#
```

## VSCode avec rust-analyser

```
ludolpif@lud-5490:/tmp$ curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg

root@lud-5490:/tmp# install -o root -g root -m 644 microsoft.gpg /etc/apt/keyrings/microsoft-archive-keyring.gpg
root@lud-5490:/tmp# cat > /etc/apt/sources.list.d/vscode.list <"EOT"
deb [arch=amd64,arm64,armhf signed-by=/etc/apt/keyrings/microsoft-archive-keyring.gpg] https://packages.microsoft.com/repos/code stable main
EOT
root@lud-5490:~# apt update
root@lud-5490:~# apt install code

root@lud-5490:~# echo "fs.inotify.max_user_instances = 16384" | tee /etc/sysctl.d/inotify_vscode.conf
root@lud-5490:~# /usr/lib/systemd/systemd-sysctl
root@lud-5490:~# cat /proc/sys/fs/inotify/max_user_instances
16384



ludolpif@lud-5490:/tmp$ cargo new hello_world
ludolpif@lud-5490:/tmp$ cd new hello_world
ludolpif@lud-5490:/tmp/hello_world$ code .
```

- installer rust-analyser via [code.visualstudio.com](https://code.visualstudio.com/docs/languages/rust#_code-navigation)
  - Menu Run, Open Configuration
  - éditer le .vscode/launch.json, Ajouter un `LD_LIBRARY_PATH` tel que cargo run le ferai :
```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "lldb",
            [...]
            "cwd": "${workspaceFolder}",
            "env": {
                "LD_LIBRARY_PATH": "/home/ludolpif/git/bevy/hello-bevy/target/debug/deps:/home/ludolpif/git/bevy/hello-bevy/target/debug:/home/ludolpif/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib:/home/ludolpif/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib"
            },
        }
    ]
}
```

- Limiter les pics de consomation de RAM lorsque VSCode lance rust-analyser
```
ludolpif@lud-5490:~$ editor ~/.cargo/config.toml
[build]
jobs = 2


ludolpif@lud-5490:/tmp/hello_world$ cargo build
ludolpif@lud-5490:/tmp/hello_world$ cargo run
```

Lire https://code.visualstudio.com/docs/languages/rust#_code-navigation


## Pipewire
```
root@lud-5490:~# apt install qpwgraph wireplumber easyeffects calf-plugins pipewire-alsa pulseaudio-
root@lud-5490:~# adduser ludolpif pipewire
```

- "Paramètres de la sesion LxQT"
  - Ajouter, "qpwgraph --minimized", cocher "Attendre le systray"
  - Décocher "Système de son PulseAudio", et "Qlipper"

### wireplumber

```
ludolpif@lud-5490:~$ wireplumber --version # config file language and format changed on 0.5
wireplumber
Compiled with libwireplumber 0.5.8
Linked with libwireplumber 0.5.8
ludolpif@lud-5490:~$ mkdir -p .local/share/wireplumber/scripts && cd .local/share/wireplumber/scripts/
ludolpif@lud-5490:~/.local/share/wireplumber/scripts$ wget https://github.com/bennetthardwick/dotfiles/raw/refs/heads/master/.config/wireplumber/scripts/dump-links.lua
ludolpif@lud-5490:~/.local/share/wireplumber/scripts$ wget https://github.com/bennetthardwick/dotfiles/raw/refs/heads/master/.config/wireplumber/scripts/dump-ports.lua
ludolpif@lud-5490:~/.local/share/wireplumber/scripts$ cd
ludolpif@lud-5490:~$ wpexec dump-ports.lua > wireplumber-dump-ports.out
ludolpif@lud-5490:~$ wpexec dump-links.lua > wireplumber-dump-links.out

ludolpif@lud-5490:~$ cat > ~/.local/share/wireplumber/scripts/auto-connect-ports.lua <<"EOT"
-- As explained on: https://bennett.dev/auto-link-pipewire-ports-wireplumber/
[...]
-- Auto connect the mic into Easy-effect first filter
auto_connect_ports {
  output = Constraint { "object.path", "matches", "alsa:acp:UA25EX:0:capture:*" },
  input = Constraint { "object.path", "matches", "ee_sie_speex:*" },
  connect = {
    ["FR"] = { "FL", "FR" }
  },
}

-- Auto disconnect unused input (FIXME make the code works)
auto_disconnect_ports {
  output = Constraint { "object.path", "matches", "alsa:acp:UA25EX:0:capture:*" },
  input = Constraint { "object.path", "matches", "ee_sie_speex:*" },
  disconnect = {
    ["FL"] = "FL"
  },
}
EOT

ludolpif@lud-5490:~$ mkdir ~/.config/wireplumber && cd ~/.config/wireplumber/
ludolpif@lud-5490:~/.config/wireplumber$ ln -s /home/ludolpif/.local/share/wireplumber/scripts/ scripts-moved-here
ludolpif@lud-5490:~/.config/wireplumber$ mkdir wireplumber.conf.d && cd wireplumber.conf.d/
ludolpif@lud-5490:~/.config/wireplumber/wireplumber.conf.d$ cat > 92-alsa-unique-descriptions.conf <<"EOT"
# ALSA node property overrides

monitor.alsa.rules = [
  {
    matches = [
      {
        node.name = "alsa_input.pci-0000_00_1f.3.analog-stereo"
      }
      {
        node.name = "alsa_output.pci-0000_00_1f.3.analog-stereo"
      }
    ]
    actions = {
      update-props = {
        node.description = "intel-pci"
      }
    }
  }
  {
    matches = [
      {
        node.name = "alsa_input.usb-Roland_EDIROL_UA-25EX-00.analog-stereo"
      }
      {
        node.name = "alsa_output.usb-Roland_EDIROL_UA-25EX-00.analog-stereo"
      }
    ]
    actions = {
      update-props = {
        node.description = "UA-25EX" # to match MIDI one
      }
    }
  }
]
EOT

ludolpif@lud-5490:~/.config/wireplumber/wireplumber.conf.d$ cat > 99-auto-connect-ports.conf <<"EOT"
wireplumber.components = [
  {
    name = auto-connect-ports.lua, type = script/lua
    provides = custom.auto-connect-ports
  }
]

wireplumber.profiles = {
  main = {
    custom.auto-connect-ports = required
  }
}
EOT

ludolpif@lud-5490:~$ systemctl --user status wireplumber
ludolpif@lud-5490:~$ systemctl --user restart wireplumber
ludolpif@lud-5490:~$ systemctl --user status wireplumber


### qpwgraph

- Menu Graph / Options / General, décocher "Enable ALSA MIDI Support"
- Éditer la patch bay
- MIDI : connecter le LaunchKey aux 5 Backlight
  - ne fonctionne que si les ports names sont différents
  - possible en personalisant le USB VendorID via boards.txt sur Arduino IDE
- Mic : On va l'auto-plug via Wireplumber (en espérant pouvoir coder le débranchement auto du channel Left inutilisé)
- Monitoring voix dans casque
  - Connecter "Easy Effects Source" à "intel-pci" (playback)
- Sauver la patchbay sous ~/obs/streaming-v1.qpwgraph

## EasyEffects

- Préférences / Lancer le service au démarrage : oui
- Préférences / Traiter tous les flux (d'entrée|de sortie) : non
- Préférences / Gestion des périphériques
  - Entrée : UA-25EX
  - Sortie : Audio interne Stéréo analogique
- Préférences / Style / thème sombre : oui
- Entrée / Ajouter un effet
  - Processeur Vocal
    - Etat : Débruiter : On, autres : Off
    - Tous les autres: paramètres par défaut
  - Compresseur
    - Mode : Renforcement
    - Quantité du Renforcement : 9.0 dB
    - Tous les autres: paramètres par défaut
- Préréglage / Local / Nom : streaming-v4
- Pipewire / Chargement automatique des réglages / Bouton en bas : Entrée
  - Périphérique : UA-25EX
  - Préréglage : streaming-v4
  - Cliquer sur "+" pour ajouter


## Essais Ardour et python Cables (non utilisé en prod)

- https://wiki.debian.org/PipeWire#JACK
- https://github.com/magillos/Cable?tab=readme-ov-file#cable

```
root@lud-5490:~# apt install pipewire-audio-client-libraries libspa-0.2-jack
ludolpif@lud-5490:~$ systemctl --user restart wireplumber pipewire pipewire-pulse

root@lud-5490:~# apt install python3-alsaaudio python3-pyqt6 python3-jack-client jack-delay
ludolpif@lud-5490:~/git$ git clone https://github.com/magillos/Cable.git
ludolpif@lud-5490:~/git/Cable$ git checkout 0.9.11
ludolpif@lud-5490:~/git/Cable$ pw-jack python3 Cable.py

root@lud-5490:~# apt install ardour
root@lud-5490:~# adduser ludolpif audio # Possiblement déjà le cas
root@lud-5490:~# cat > /etc/security/limits.d/50-audio.conf <<"EOT"
@audio   - rtprio  95
@audio   - nice    -19
@audio   - memlock unlimited
EOT
root@lud-5490:~# reboot

# Essai avec pipewire, bien mais sans régler aucun buffer, c'est un peu laggy pour le recording au metronome.
# Ardour supporte une auto-mesure + configuration de délai, mais plutôt sur la partie PCM.
ludolpif@lud-5490:~$ pw-jack ardour

# Essai avec Alsa en désactivant tout le reste de l'audio de la session
ludolpif@lud-5490:~$ systemctl --user stop wireplumber.service ; systemctl --user stop pipewire.socket ; systemctl --user stop pipewire.service
ludolpif@lud-5490:~$ ardour
# Ca ne semble pas apporter de grands intérêts immédiats (buffers de 512 sinon son haché sans réglages kernel particuliers)
```

## Premier lancement OBS
- Alt-F2 obs
- Assistant de config : Annuler
- Fichier / Paramètres / Général / Sortie
  - Confirmation à l'arrêt d'un stream
  - Enregistrement auto lors d'un stream
- Fichier / Paramètres / Général / Déclanchement d'alignement des sources
  - Décocher "Déclancher avec le bord de l'écran # pour placer la camera librement
- Sortie / Streaming
  - Mode de Sortie : Avancé
  - Encodeur : FFMpeg VAAPI H.264
  - Appareil VAAPI : UHD Graphics 620
  - Profil : High
  - Débit vidéo : 3000kbps
  - Image-clés : 2s
- Sortie / Enregistrement / Chemin : /home/ludolpif/Vidéos
- Audio / Périphériques audio globaux
  - Audio du bureau : Désactivé
  - Mic : EasyEffects Source
  - le reste : Désactivé
- Vidéo / Résolution de sortie : 1920*1080 30fps ( ou 1536*864, 60fps )
- Avancé / Enregistrement / Format nom : %CCYY-%MM-%DD_%hh-%mm-%ss-stream-%VF-%ORES-%FPSfps

## Config navigateurs

### Firefox : général purpose

- Préférences / Accueil
  - Accueil / Contenu de la page d'accueil : Raccourcis, non
  - Ctrl+Shift+B pour hide la bookmarks bar
- Préférences / Vie privée
  - Cookie et données de sites : Supprimer à la fermeture de Firefox
  - Vie privée / Protection renforcée contre le pistage : Stricte
  - Vie privée / Do not sell + Do not track
  - Identifiants et mots de passe : non
  - Historique : Ne jamais conserver l'historique

### Chromium

- Utilisé pour sessions connectées Twitch / Youtube / GitHub / BlueSky.
- Configuration par défaut, on éviter de naviguer avec en dehors des sites sus-mentionnés.

Les dashboard Youtube et Twitch manger trop de GPU et trop de CPU respectivement pour streamer en parallèle avec la compression vidéo offloeadée sur le iGPU Intel de mon Dell 5490. Penser à pop-out les tchat et fermer les dashboards dès qu'on a lancé le stream.

## Arduino

```
root@lud-5490:~# apt install arduino
root@lud-5490:~# adduser ludolpif dialout # Accès aux ports série
```

- Menu Fichier / Préférences / Paramaètres / URL de gestionnaire de cartes supplémentaires
  - Coller [la cible de ce lien](https://raw.githubusercontent.com/sparkfun/Arduino_Boards/main/IDE_Board_Manager/package_sparkfun_index.json)
- Menu Outils / Type de Carte / Gestionnaire de Carte
  - Chercher sparkfun
  - Installer SparkFun AVR Boards
- Menu Outils / Type de Carte / Sparkfun / SparkFun Pro Micro
  - Processeur : 3.3V, 8Mhz
  - attention de pas mélanger avec les boards 5V comme celle du projet 1Keyboard2Computers

- Corriger les chemins pour les outils d'upload du code sur ces board là

- Installer la libraries MIDIUSB
  - https://www.arduino.cc/reference/en/libraries/midiusb/
  - Outil / Gérer les bibliothèques / MIDIUSB v1.0.5
- Fichier / Exemple / MIDIUSB / MIDIUSB_read
  - Vérifier *vraiment* qu'on a bien pro Micro 8Mhz (sinon brick)
  - Compiler / Téléverser
- Tester le MIDI
  - Outil / Moniteur Série
  - Dans qpwgraph, relier le clavier Midi à l'entrée Midi de l'arduino

- En cas de brick :
  - le bootloader ne dure que 750ms après un reset donc pour reflasher
  - pré-compiler un blink en ayant choisi le bon type de CPU
  - il faut doucle-click le reset (il faut le short to GND)
  - du coup le bootload reste 8 secondes
  - téléverser le blink pendnat ce laps de temps là
  - normalement c'est ubbrick
```
ludolpif@lud-5490:~$ editor ~/.arduino15/packages/SparkFun/hardware/avr/1.1.13/platform.txt

compiler.path=/usr/bin/

# AVR Uploader/Programmers tools
# ------------------------------
tools.avrdude.path=/usr/share/arduino/hardware/tools
tools.avrdude.cmd.path={path}/avrdude
tools.avrdude.config.path={path}/avrdude.conf
```

## Non réinstallés (par rapport au setup 2024

- picoscope : plutôt le mettre sur le PC fixe
  - 500 Mo de dépendances Mono
  - il wrek les associations de fichiers
  - aime manger du CPU
- v4l2loopback-utils : pour camera virtuelle dans OBS
  - ça amène dkms et 450 Mio de toolchain / headers et du secureboot MOK
- shadertastic : OMG il faut que je reprenne le packaging debian !!
- asciinema : pour enregistrer des session terminal, type waiting-screen
- audacity : n'implémente pas pipewire, puis ardour est pour l'usage que j'ai
- pianoteq/organteq : super chouette, mais propriétaire
- cpufrequtils
  - pourrai être utile pour :
  - `for p in $(sed -ne 's/^processor\s\+:\s\+//p' /proc/cpuinfo); do cpufreq-set -c $p -g performance; done
`

